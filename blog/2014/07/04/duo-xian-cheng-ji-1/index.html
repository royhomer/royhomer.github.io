
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>å¤šçº¿ç¨‹åŸºç¡€01 æ¦‚å¿µå’ŒNSThread - Royhomer.luo Octopress Blog</title>
  <meta name="author" content="Royhomer.luo (ç½—å®)">

  
  <meta name="description" content="åœ¨è½¯ä»¶å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ä¼šæ¥è§¦åˆ°ä¸€ä¸ªè¯è¯­&ndash;å¤šçº¿ç¨‹ï¼› é‚£ä¹ˆä»€ä¹ˆæ˜¯å¤šçº¿å‘¢ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å¯¹å¤šçº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†åšç®€å•è®²è§£ã€‚ 1 åŸºæœ¬æ¦‚å¿µ 1.1 è¿›ç¨‹çš„æ¦‚å¿µ è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿæ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªè¿›ç¨‹æ˜¯ç›¸å¯¹ç‹¬ç«‹ eg: å½“æˆ‘ä»¬å¯åŠ¨QQï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯ä¸€ä¸ªè¿›ç¨‹ 1.2 çº¿ç¨‹çš„æ¦‚å¿µ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://royhomer.github.io/blog/2014/07/04/duo-xian-cheng-ji-1/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Royhomer.luo Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<!-- <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"> -->
<script type="text/javascript">
	function addBlankTargetForLinks () {
   		$('a[href^="http"]').each(function(){
       		$(this).attr('target', '_blank');
   		});
 	}
 
 	$(document).bind('DOMNodeInserted', function(event) {
  	addBlankTargetForLinks();
 	});
</script>
  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Royhomer.luo Octopress Blog</a></h1>
  
    <h2>ç½—å®çš„æŠ€æœ¯åšå®¢</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="royhomer.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">é¦–é¡µ</a></li>
  <li><a href="/blog/archives">æ‰€æœ‰æ–‡ç« </a></li>
  <li><a href="/about">å…³äºæˆ‘</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h2 class="entry-title">å¤šçº¿ç¨‹åŸºç¡€01 æ¦‚å¿µå’ŒNSThread</h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-04T12:21:39+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:21 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><!-- more-->


<p>   åœ¨è½¯ä»¶å¼€å‘ä¸­å¿…ä¸å¯å°‘çš„ä¼šæ¥è§¦åˆ°ä¸€ä¸ªè¯è¯­&ndash;å¤šçº¿ç¨‹ï¼›
   é‚£ä¹ˆä»€ä¹ˆæ˜¯å¤šçº¿å‘¢ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å¯¹å¤šçº¿ç¨‹çš„åŸºç¡€çŸ¥è¯†åšç®€å•è®²è§£ã€‚</p>

<hr />

<h2>1 åŸºæœ¬æ¦‚å¿µ</h2>

<h4>1.1 è¿›ç¨‹çš„æ¦‚å¿µ</h4>

<ul>
<li><p>è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿæ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªè¿›ç¨‹æ˜¯ç›¸å¯¹ç‹¬ç«‹</p>

<p>  eg: å½“æˆ‘ä»¬å¯åŠ¨QQï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯ä¸€ä¸ªè¿›ç¨‹</p></li>
</ul>


<h4>1.2 çº¿ç¨‹çš„æ¦‚å¿µ</h4>

<ul>
<li>æ¯ä¸ªè¿›ç¨‹ä¸­è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹ã€‚ï¼ˆä¸€ä¸ªç¨‹åºçš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼‰</li>
<li>ä¸€ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯<code>ä¸²è¡Œçš„</code></li>
</ul>


<h4>1.3 å¤šçº¿ç¨‹çš„æ¦‚å¿µ</h4>

<ul>
<li>ä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ

<ul>
<li>ä¸»çº¿ç¨‹ : è‡ªåŠ¨åˆ›å»ºçš„ï¼Œé»˜è®¤çš„ åˆå«UIçº¿ç¨‹</li>
<li>å­çº¿ç¨‹ : åˆå«åå°çº¿ç¨‹</li>
</ul>
</li>
</ul>


<h6>å¤šçº¿ç¨‹åŸç†</h6>

<ul>
<li>CPUåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿçš„åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ï¼›è°ƒåº¦é¢‘ç‡å¿«ï¼Œå°±å½¢æˆäº†å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„â€œå‡è±¡â€ã€‚æ‰€ä»¥ç§»åŠ¨ç«¯ä¸å»ºè®®å¼€å¤ªå¤šçº¿ç¨‹ä¸€èˆ¬åœ¨5æ¡ä»¥å†…</li>
</ul>


<h6>å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹</h6>

<ul>
<li>ä¼˜ç‚¹ï¼šèƒ½é€‚å½“æé«˜æ‰§è¡Œæ•ˆç‡ã€èµ„æºï¼ˆCPUï¼Œå†…å­˜ï¼‰åˆ©ç”¨ç‡</li>
<li>ç¼ºç‚¹ï¼šå¼€å¯çº¿ç¨‹å ç”¨å†…å­˜ï¼Œå¼€é”€å¤§ï¼Œæ€§èƒ½é™ä½</li>
</ul>


<h6>å¤šçº¿ç¨‹åœ¨iOSå¼€å‘ä¸­çš„åº”ç”¨</h6>

<ul>
<li>é»˜è®¤æœ‰ä¸€æ¡ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰æœ‰ä¸”åªæœ‰ä¸€æ¡ã€‚ä½œç”¨ï¼šè´Ÿè´£æ˜¾ç¤ºå’Œåˆ·æ–°ç•Œé¢ï¼Œå¤„ç†UIäº‹ä»¶</li>
<li><code>æ³¨æ„</code>ï¼šä¸è¦æŠŠè€—æ—¶æ“ä½œæ”¾åœ¨ä¸»çº¿ç¨‹ä¸­</li>
</ul>


<h2>2 iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ</h2>

<p><img src="/images/2014/07/duoxianchengjichu.png" alt="" /></p>

<h2>3 pthreadçš„ä¾‹å­</h2>

<pre><code>- (void)viewDidLoad {
Â  Â  [super viewDidLoad];
Â Â  Â 
Â  Â  // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦
Â  Â  pthread_t myrestrict;
Â Â  Â 
Â  Â  // 1param çº¿ç¨‹æ ‡è¯†ç¬¦å˜é‡çš„åœ°å€, 2param å†™NULL 3param æ‰§è¡Œçš„çš„å‡½æ•° 4param NULL
Â  Â  pthread_create(&amp;myrestrict, NULL, run, NULL);
}

// å®šä¹‰çº¿ç¨‹çš„å‡½æ•°
void *run(void *data) {
Â Â  Â 
Â  Â  NSLog(@"%@", [NSThread currentThread]);
Â Â  Â 
Â  Â  return nil;
}
</code></pre>

<h2>4 NSThreadçš„åŸºæœ¬ç”¨æ³•</h2>

<h4>åˆ›å»ºæ–¹å¼1 åˆ›å»ºåéœ€å¯åŠ¨</h4>

<pre><code>    //åˆ›å»ºçº¿ç¨‹
    NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(download) object:nil];
    // å¯åŠ¨çº¿ç¨‹
Â   [thread start];
Â 
</code></pre>

<h4>åˆ›å»ºæ–¹å¼2Â  åˆ›å»ºåè‡ªåŠ¨å¯åŠ¨</h4>

<pre><code>    // åˆ›å»ºåç›´æ¥å¯åŠ¨Â  ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²
    [NSThread detachNewThreadSelector:@selector(download2:) toTarget:self withObject:@"param"];
Â Â  Â 
</code></pre>

<h4>åˆ›å»ºæ–¹å¼3Â  éšå¼å¯åŠ¨</h4>

<pre><code>Â  Â  // å¼€å¯å­çº¿ç¨‹
Â  Â  [self performSelectorInBackground:@selector(download) withObject:nil];
Â  Â  // å¼€å¯ä¸»çº¿ç¨‹
Â  Â  [self performSelector:@selector(download) withObject:nil];
Â  Â  // å¼€å¯ä¼ å…¥çš„çº¿ç¨‹
Â  Â  [self performSelector:@selector(download) onThread:[NSThread currentThread] withObject:nil waitUntilDone:NO];
</code></pre>

<h4>å…¶å®ƒå¸¸ç”¨æ–¹æ³•</h4>

<pre><code>Â Â   // è·å–å½“å‰çº¿ç¨‹
Â  Â  NSThread *current = [NSThread currentThread];
Â  Â  // è·å–ä¸»çº¿ç¨‹
Â  Â  NSThread *main = [NSThread mainThread];
Â  Â  // åˆ¤æ–­æ˜¯å¦ä¸»çº¿ç¨‹-ç±»æ–¹æ³•
Â  Â  BOOL isMain = [NSThread isMainThread];
Â  Â  // åˆ¤æ–­æ˜¯å¦ä¸»çº¿ç¨‹-å¯¹è±¡æ–¹æ³•
Â  Â  BOOL isMain2 = [main isMainThread];
Â  Â  // ç»™çº¿ç¨‹èµ·åå­—
Â  Â  current.name = @"ä¸‹è½½çº¿ç¨‹";
Â  Â  // çº¿ç¨‹ç¡çœ çŠ¶æ€5ç§’
Â  Â  [NSThread sleepForTimeInterval:5.0];
Â  Â  // çº¿ç¨‹ç¡çœ ä»ç°åœ¨å¼€å§‹3ç§’ä»¥åçš„æ—¶é—´
Â  Â  [NSThread sleepUntilDate:[NSDate dateWithTimeIntervalSinceNow:3]];
    // çº¿ç¨‹é€€å‡º çº¿ç¨‹è¿›å…¥æ­»äº¡çŠ¶æ€
    [NSThread exit];
</code></pre>

<h4>çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</h4>

<pre><code>[self performSelectorOnMainThread:@selector(method) withObject:nil waitUntilDone:YES];

[self performSelector:@selector(method) onThread:[NSThread mainThread] withObject:nil waitUntilDone:YES];
</code></pre>

<ul>
<li>waitUntilDone: æ˜¯å¦ç­‰å¾…æ‰§è¡Œå®Œ   performSelector:æ‰§è¡Œçš„æ–¹æ³•  withObject: ä¼ å‚æ•°</li>
</ul>


<h2>5.çº¿ç¨‹å®‰å…¨</h2>

<ul>
<li><p>çº¿ç¨‹å®‰å…¨</p>

<ul>
<li>æ¦‚å¿µ : å¤šä¸ªçº¿ç¨‹å¤ºå–åŒä¸€ä¸ªèµ„æºï¼Œè®¿é—®ä¸€ä¸ªå˜é‡</li>
<li>è§£å†³æ–¹æ¡ˆ : åŠ é”&ndash;çº¿ç¨‹é”, äº’æ–¥é”</li>
<li>äº’æ–¥é”çš„æ ¼å¼ : <code>@synchronized(self) { // æ’å…¥é”å®šä»£ç  }</code></li>
<li><code>æ³¨æ„</code> : ä¸€ä»½ä»£ç åªèƒ½ç”¨ä¸€ä¸ªé”, å¤šä¸ªé”æ— æ•ˆ</li>
</ul>
</li>
<li><p>çº¿ç¨‹é”ä¼˜ç¼ºç‚¹</p>

<ul>
<li>ä¼˜ç‚¹ : èƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢å› å¤šçº¿ç¨‹æŠ¢å¤ºèµ„æºé€ æˆçš„æ•°æ®å®‰å…¨é—®é¢˜</li>
<li>ç¼ºç‚¹ : æ¶ˆè€—å¤§é‡CPUèµ„æº</li>
</ul>
</li>
<li><p>çº¿ç¨‹åŒæ­¥</p>

<ul>
<li>å¤šæ¡çº¿ç¨‹åœ¨åŒä¸€æ¡çº¿ä¸Šæ‰§è¡Œï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰</li>
<li>äº’æ–¥é”å°±è¿ç”¨äº†çº¿ç¨‹åŒæ­¥</li>
</ul>
</li>
<li><p>åŸå­å±æ€§å’ŒéåŸå­å±æ€§</p>

<ul>
<li>atomic ä¼šè‡ªåŠ¨ä¸ºsetteræ–¹æ³•åŠ é”</li>
<li>nonatomic ä¸ä¼šä¸ºsetteræ–¹æ³•  æ¨èä½¿ç”¨è¿™ä¸ª</li>
</ul>
</li>
</ul>


<h2>6.å¤šçº¿ç¨‹çŠ¶æ€ç¤ºæ„å›¾</h2>

<h5>åœ¨äº†è§£å®Œçº¿ç¨‹å®‰å…¨åå’±ä»¬å†çœ‹çœ‹å®Œæ•´çš„çº¿ç¨‹çŠ¶æ€ç¤ºæ„å›¾</h5>

<p><img src="/images/2014/07/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="" /></p>

<p>Â  Â </p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Royhomer.luo (ç½—å®)</span></span>

      




<time class='entry-date' datetime='2014-07-04T12:21:39+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:21 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/duo-xian-cheng/'>å¤šçº¿ç¨‹</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/07/03/zen-yang-da-jian-gitbubpagebo-ke/" title="Previous Post: æ­å»ºä¸€ä¸ªgithubåšå®¢åŸºäºOctopress">&laquo; æ­å»ºä¸€ä¸ªgithubåšå®¢åŸºäºOctopress</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/07/05/duo-xian-cheng-ji-2/" title="Next Post: å¤šçº¿ç¨‹åŸºç¡€02 GCD">å¤šçº¿ç¨‹åŸºç¡€02 GCD &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>æ–‡ç« åˆ†ç±»</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/octopressbo-ke-da-jian/'>octopressåšå®¢æ­å»º (1)</a></li>
<li class='category'><a href='/blog/categories/dan-li-mo-shi-xiang-guan/'>å•ä¾‹æ¨¡å¼ç›¸å…³ (1)</a></li>
<li class='category'><a href='/blog/categories/duo-xian-cheng/'>å¤šçº¿ç¨‹ (3)</a></li>

  </ul>
</section><section>
  <h1>ğŸ˜ƒæœ€è¿‘æ–‡ç« </h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/15/dan-li-mo-shi/">å•ä¾‹æ¨¡å¼</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/07/duo-xian-cheng-ji-3/">å¤šçº¿ç¨‹åŸºç¡€03 NSOperation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/05/duo-xian-cheng-ji-2/">å¤šçº¿ç¨‹åŸºç¡€02 GCD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/04/duo-xian-cheng-ji-1/">å¤šçº¿ç¨‹åŸºç¡€01 æ¦‚å¿µå’ŒNSThread</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/03/zen-yang-da-jian-gitbubpagebo-ke/">æ­å»ºä¸€ä¸ªgithubåšå®¢åŸºäºOctopress</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  &copy; 2015 - Royhomer.luo (ç½—å®) -
  <span class="credit"> åŸºäº <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
